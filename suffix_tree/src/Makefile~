.PHONY: all clean

ROOT_DIR = ..
SRC_DIR  = $(addprefix $(ROOT_DIR)/, src)
OBJ_DIR  = $(addprefix $(ROOT_DIR)/, obj)
BIN_DIR  = $(addprefix $(ROOT_DIR)/, bin)
TEST_DIR = $(addprefix $(ROOT_DIR)/, tests)

LIB_NAMES = utils
LIB_FLAGS = $(addprefix -l, $(LIB_NAMES))

CC	= gcc
CFLAGS	= -g -I$(SRC_DIR) -std=c99 -Wall -D__USE_FIXED_PROTOTYPES__

# Google Test config
# for 'GTEST_DIR' environment variable
SHELL := /bin/zsh
# Flags passed to the preprocessor.
CPPFLAGS += -isystem $(GTEST_DIR)/include
# Flags passed to the C++ compiler.
CXXFLAGS += -g -Wall -Wextra -pthread


SFTR_NAME = suffix_tree
SFTR_SRC  = $(addprefix $(SRC_DIR)/, $(addsuffix .c, $(SFTR_NAME)))
SFTR_HDR  = $(addprefix $(SRC_DIR)/, $(addsuffix .h, $(SFTR_NAME)))
SFTR_OBJ  = $(addprefix $(OBJ_DIR)/, $(addsuffix .o, $(SFTR_NAME)))
SFTR_BIN  = $(addprefix $(BIN_DIR)/, $(SFTR_NAME))
SFTR_ODEP = $(SFTR_SRC) $(SFTR_HDR)
SFTR_BDEP = $(SFTR_OBJ)

SFTR_TEST_NAME = $(addsuffix _test, $(SFTR_NAME))
SFTR_TEST_SRC  = $(addprefix $(TEST_DIR)/, $(addsuffix .cc, $(SFTR_TEST_NAME)))
SFTR_TEST_OBJ  = $(addprefix $(OBJ_DIR)/,  $(addsuffix .o,  $(SFTR_TEST_NAME)))
SFTR_TEST_BIN  = $(addprefix $(TEST_DIR)/, $(SFTR_TEST_NAME)))
SFTR_TEST_ODEP = $(SFTR_TREE_SRC) $(SFTR_ODEP) 
SFTR_TEST_BDEP = $(SFTR_TREE_OBJ)


# ALL_TESTS = $(SFTR_TEST_BIN)
ALL_BINS  = $(SFTR_BIN)
ALL_OBJS  = $(SFTR_OBJ)
ALL_TRGTS = $(ALL_BINS) $(ALL_OBJS)

SRC_TMPS  = $(addprefix $(SRC_DIR)/,  *~)
TEST_TMPS = $(addprefix $(TEST_DIR)/, *~)
ROOT_TMPS = $(addprefix $(ROOT_DIR)/, *~)
ALL_TMPS  = $(SRC_TMPS) $(TEST_TMPS) $(ROOT_TMPS)


all: $(ALL_TRGTS)

$(SFTR_BIN): $(SFTR_BDEP)
	$(CC) $(CFLAGS) $(LIB_FLAGS) -o $@ $^

$(SFTR_OBJ): $(SFTR_ODEP)
	$(CC) $(CFLAGS) $(LIB_FLAGS) -c -o $@ $<

clean:
	$(RM) $(ALL_TRGTS) $(ALL_TMPS)
